<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Elderly Care - Community Support</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Font: Saraburi -->
  <link href="https://fonts.googleapis.com/css2?family=Saraburi:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- SweetAlert2 for nice alerts (No more native alerts) -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      font-family: 'Saraburi', sans-serif;
      background-color: #f0f9ff;
    }

    .btn-press {
      transition: transform 0.1s;
    }

    .btn-press:active {
      transform: scale(0.95);
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    /* Step Wizard Styles */
    .step-active {
      @apply bg-sky-600 text-white border-sky-600;
    }

    .step-inactive {
      @apply bg-white text-gray-400 border-gray-300;
    }

    .option-selected {
      @apply border-sky-500 bg-sky-50 ring-2 ring-sky-500;
    }
  </style>
</head>

<body class="text-gray-800 h-screen flex flex-col overflow-hidden">

  <!-- 1. Login Screen -->
  <div id="loginScreen" class="fixed inset-0 z-50 bg-white flex flex-col justify-center items-center p-6">
    <div class="mb-8 text-center">
      <i class="fas fa-hands-helping text-6xl text-sky-500 mb-4"></i>
      <h1 class="text-3xl font-bold text-sky-700">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞</h1>
      <p class="text-xl text-gray-500 mt-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
    </div>
    <button onclick="handleLogin()"
      class="w-full max-w-sm bg-white border-2 border-gray-300 p-4 rounded-xl flex items-center justify-center gap-3 shadow-sm hover:bg-gray-50 btn-press">
      <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-8 h-8" alt="Google">
      <span class="text-xl font-medium">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google</span>
    </button>
  </div>

  <!-- Main Layout -->
  <div id="app" class="hidden flex h-full">

    <!-- Sidebar -->
    <nav class="w-64 bg-white shadow-lg flex-col hidden md:flex justify-between">
      <div>
        <div class="p-6 bg-sky-600 text-white">
          <h2 class="text-2xl font-bold">‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏™‡∏ô‡∏™‡∏∏‡∏Ç</h2>
          <p id="userNameDisplay" class="text-sky-100 mt-1">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</p>
        </div>
        <div class="flex flex-col p-4 gap-2">
          <button onclick="showPage('home')"
            class="nav-btn p-4 text-left text-lg rounded-lg hover:bg-sky-50 text-sky-700 font-bold bg-sky-50">
            <i class="fas fa-home w-8"></i> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
          </button>
          <button onclick="showPage('shuttle')"
            class="nav-btn p-4 text-left text-lg rounded-lg hover:bg-sky-50 text-gray-600">
            <i class="fas fa-bus w-8"></i> ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏£‡∏ñ‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á
          </button>
          <button onclick="showPage('activity')"
            class="nav-btn p-4 text-left text-lg rounded-lg hover:bg-sky-50 text-gray-600">
            <i class="fas fa-users w-8"></i> ‡∏à‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
          </button>
          <button class="nav-btn p-4 text-left text-lg rounded-lg hover:bg-sky-50 text-gray-600">
            <i class="fas fa-cog w-8"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
          </button>
        </div>
      </div>
      <div class="p-4">
        <button onclick="triggerSOS()"
          class="w-full bg-red-500 text-white p-6 rounded-xl text-2xl font-bold shadow-lg hover:bg-red-600 animate-pulse">
          <i class="fas fa-exclamation-circle mr-2"></i> SOS ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô
        </button>
      </div>
    </nav>

    <!-- Mobile Header -->
    <div
      class="md:hidden fixed top-0 w-full bg-sky-600 text-white p-4 z-40 flex justify-between items-center shadow-md">
      <div class="text-xl font-bold">‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏™‡∏ô‡∏™‡∏∏‡∏Ç</div>
      <button onclick="toggleMobileMenu()" class="text-2xl"><i class="fas fa-bars"></i></button>
    </div>

    <!-- Main Content -->
    <main class="flex-1 bg-sky-50 relative overflow-y-auto pt-16 md:pt-0 no-scrollbar">

      <!-- Page: Dashboard (Home) -->
      <div id="page-home" class="p-4 md:p-8 max-w-4xl mx-auto space-y-6">
        <!-- Status Card -->
        <div id="statusCard" class="bg-white p-6 rounded-2xl shadow-sm border-l-8 border-gray-300">
          <h3 class="text-xl font-bold text-gray-500">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
          <p class="text-2xl mt-2 text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>
        </div>

        <!-- Recently Used -->
        <h3 class="text-xl font-bold text-gray-700 mt-4">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <div class="flex gap-4 overflow-x-auto pb-2">
          <div
            class="bg-white p-4 rounded-xl min-w-[150px] shadow-sm flex flex-col items-center gap-2 border border-gray-100">
            <div class="bg-sky-100 p-3 rounded-full"><i class="fas fa-store text-sky-600 text-xl"></i></div>
            <span>‡πÑ‡∏õ‡∏ï‡∏•‡∏≤‡∏î</span>
          </div>
          <div
            class="bg-white p-4 rounded-xl min-w-[150px] shadow-sm flex flex-col items-center gap-2 border border-gray-100">
            <div class="bg-orange-100 p-3 rounded-full"><i class="fas fa-user-md text-orange-600 text-xl"></i></div>
            <span>‡πÑ‡∏õ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å</span>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid grid-cols-2 gap-4 mt-2">
          <button onclick="showPage('shuttle')"
            class="bg-sky-600 text-white p-6 rounded-2xl shadow-md btn-press flex flex-col items-center gap-3">
            <i class="fas fa-bus text-4xl"></i>
            <span class="text-2xl font-bold">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏£‡∏ñ</span>
          </button>
          <button onclick="showPage('activity')"
            class="bg-emerald-500 text-white p-6 rounded-2xl shadow-md btn-press flex flex-col items-center gap-3">
            <i class="fas fa-calendar-check text-4xl"></i>
            <span class="text-2xl font-bold">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</span>
          </button>
        </div>
      </div>

      <!-- Page: Shuttle Service -->
      <div id="page-shuttle" class="hidden p-4 md:p-8 max-w-4xl mx-auto pb-24">
        <div class="flex items-center gap-4 mb-6">
          <button onclick="showPage('home')" class="bg-white p-3 rounded-full shadow-sm"><i
              class="fas fa-arrow-left"></i></button>
          <h2 class="text-3xl font-bold text-sky-800">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á</h2>
        </div>
        <div id="vehicleList" class="space-y-4">
          <div class="text-center p-8 text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ...</div>
        </div>
      </div>

      <!-- Page: Booking Wizard (FULL VERSION) -->
      <div id="page-booking" class="hidden p-4 md:p-8 max-w-4xl mx-auto pb-24 h-full flex flex-col">
        <!-- Header -->
        <div class="flex items-center gap-4 mb-6 shrink-0">
          <button onclick="showPage('shuttle')" class="bg-white p-3 rounded-full shadow-sm"><i
              class="fas fa-arrow-left"></i></button>
          <h2 class="text-2xl font-bold text-sky-800">‡∏à‡∏≠‡∏á‡∏£‡∏ñ: <span id="booking-vehicle-name"
              class="text-sky-600">...</span></h2>
        </div>

        <!-- Step Indicators -->
        <div class="flex justify-between items-center mb-8 px-4 shrink-0">
          <div class="flex flex-col items-center step-indicator" id="step-1-ind">
            <div class="w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold mb-1 step-active">1
            </div>
            <span class="text-sm">‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</span>
          </div>
          <div class="h-1 flex-1 bg-gray-200 mx-2 relative top-[-10px]"></div>
          <div class="flex flex-col items-center step-indicator" id="step-2-ind">
            <div class="w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold mb-1 step-inactive">2
            </div>
            <span class="text-sm">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>
          </div>
          <div class="h-1 flex-1 bg-gray-200 mx-2 relative top-[-10px]"></div>
          <div class="flex flex-col items-center step-indicator" id="step-3-ind">
            <div class="w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold mb-1 step-inactive">3
            </div>
            <span class="text-sm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</span>
          </div>
        </div>

        <!-- Wizard Content -->
        <div class="bg-white p-6 rounded-2xl shadow-sm flex-1 overflow-y-auto">

          <!-- STEP 1: Destination -->
          <div id="step-1" class="wizard-step">
            <h3 class="text-xl font-bold mb-4">‡∏à‡∏∞‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö?</h3>

            <!-- Current Location (Fixed) -->
            <div class="bg-gray-50 p-4 rounded-xl mb-6 flex items-center gap-3 border border-gray-200">
              <i class="fas fa-map-marker-alt text-red-500 text-xl"></i>
              <div>
                <p class="text-sm text-gray-500">‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å</p>
                <p class="font-bold text-lg">‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (GPS)</p>
              </div>
            </div>

            <!-- Destination Grid -->
            <div class="grid grid-cols-2 gap-4">
              <div onclick="selectDestination('clubhouse')"
                class="dest-card p-4 border-2 rounded-xl text-center cursor-pointer hover:bg-sky-50 transition-all border-gray-200"
                data-value="clubhouse">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2 text-3xl">
                  üèä‚Äç‚ôÇÔ∏è</div>
                <span class="font-bold text-lg">‡∏™‡πÇ‡∏°‡∏™‡∏£</span>
              </div>
              <div onclick="selectDestination('market')"
                class="dest-card p-4 border-2 rounded-xl text-center cursor-pointer hover:bg-sky-50 transition-all border-gray-200"
                data-value="market">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2 text-3xl">
                  ü•¶</div>
                <span class="font-bold text-lg">‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡∏±‡∏î</span>
              </div>
              <div onclick="selectDestination('clinic')"
                class="dest-card p-4 border-2 rounded-xl text-center cursor-pointer hover:bg-sky-50 transition-all border-gray-200"
                data-value="clinic">
                <div class="w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-2 text-3xl">
                  üè•</div>
                <span class="font-bold text-lg">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å</span>
              </div>
              <div onclick="selectDestination('park')"
                class="dest-card p-4 border-2 rounded-xl text-center cursor-pointer hover:bg-sky-50 transition-all border-gray-200"
                data-value="park">
                <div
                  class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-2 text-3xl">üå≥
                </div>
                <span class="font-bold text-lg">‡∏™‡∏ß‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</span>
              </div>
            </div>
          </div>

          <!-- STEP 2: Details -->
          <div id="step-2" class="wizard-step hidden">
            <h3 class="text-xl font-bold mb-4">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</h3>

            <!-- Time -->
            <div class="mb-6">
              <label class="block text-gray-600 mb-2 font-bold">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label>
              <div class="flex gap-4">
                <button onclick="selectTimeType('now')" id="btn-time-now"
                  class="flex-1 p-4 rounded-xl border-2 border-sky-500 bg-sky-50 text-sky-700 font-bold">
                  <i class="fas fa-clock mr-2"></i> ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢
                </button>
                <button onclick="selectTimeType('later')" id="btn-time-later"
                  class="flex-1 p-4 rounded-xl border-2 border-gray-200 text-gray-500">
                  <i class="fas fa-calendar-alt mr-2"></i> ‡∏à‡∏≠‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
                </button>
              </div>
              <!-- Time Picker (Hidden by default) -->
              <div id="time-picker-container" class="hidden mt-4 bg-gray-50 p-4 rounded-xl animate-fade-in">
                <label class="text-sm text-gray-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤:</label>
                <input type="time" id="scheduled-time"
                  class="w-full mt-1 p-3 text-xl rounded-lg border border-gray-300">
              </div>
            </div>

            <!-- Passengers -->
            <div class="mb-6">
              <label class="block text-gray-600 mb-2 font-bold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£</label>
              <div class="flex items-center gap-4 bg-gray-50 p-2 rounded-xl w-fit">
                <button onclick="adjustPassenger(-1)"
                  class="w-12 h-12 bg-white rounded-lg shadow text-xl font-bold hover:bg-gray-100">-</button>
                <span id="passenger-count" class="text-2xl font-bold w-8 text-center">1</span>
                <button onclick="adjustPassenger(1)"
                  class="w-12 h-12 bg-white rounded-lg shadow text-xl font-bold hover:bg-gray-100">+</button>
              </div>
            </div>

            <!-- Options -->
            <div>
              <label class="block text-gray-600 mb-2 font-bold">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏û‡∏¥‡πÄ‡∏®‡∏©</label>
              <label
                class="flex items-center p-3 rounded-xl border border-gray-200 mb-2 cursor-pointer hover:bg-gray-50">
                <input type="checkbox" id="opt-wheelchair" class="w-5 h-5 text-sky-600 rounded">
                <span class="ml-3 text-lg"><i class="fas fa-wheelchair text-sky-500 mr-2"></i> ‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô</span>
              </label>
              <label class="flex items-center p-3 rounded-xl border border-gray-200 cursor-pointer hover:bg-gray-50">
                <input type="checkbox" id="opt-helper" class="w-5 h-5 text-sky-600 rounded">
                <span class="ml-3 text-lg"><i class="fas fa-user-nurse text-pink-500 mr-2"></i> ‡∏Ñ‡∏ô‡∏û‡∏¢‡∏∏‡∏á</span>
              </label>
            </div>
          </div>

          <!-- STEP 3: Summary -->
          <div id="step-3" class="wizard-step hidden">
            <div class="text-center mb-6">
              <h3 class="text-2xl font-bold text-sky-800">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
              <p class="text-gray-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</p>
            </div>

            <div class="bg-sky-50 p-6 rounded-2xl border border-sky-100 space-y-4">
              <div class="flex justify-between border-b border-sky-200 pb-2">
                <span class="text-gray-500">‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å</span>
                <span class="font-bold text-sky-700" id="sum-vehicle">...</span>
              </div>
              <div class="flex justify-between border-b border-sky-200 pb-2">
                <span class="text-gray-500">‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</span>
                <span class="font-bold text-lg" id="sum-dest">...</span>
              </div>
              <div class="flex justify-between border-b border-sky-200 pb-2">
                <span class="text-gray-500">‡πÄ‡∏ß‡∏•‡∏≤</span>
                <span class="font-bold text-lg text-orange-600" id="sum-time">...</span>
              </div>
              <div class="flex justify-between border-b border-sky-200 pb-2">
                <span class="text-gray-500">‡∏ú‡∏π‡πâ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£</span>
                <span class="font-bold" id="sum-passengers">1 ‡∏ó‡πà‡∏≤‡∏ô</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-500">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</span>
                <span class="font-bold text-right" id="sum-options">-</span>
              </div>
            </div>
          </div>

        </div>

        <!-- Footer Navigation -->
        <div class="mt-4 shrink-0 flex gap-4">
          <button id="btn-back" onclick="prevStep()"
            class="flex-1 bg-gray-200 text-gray-700 p-4 rounded-xl text-xl font-bold hidden">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
          <button id="btn-next" onclick="nextStep()"
            class="flex-1 bg-sky-600 text-white p-4 rounded-xl text-xl font-bold shadow-lg">‡∏ï‡πà‡∏≠‡πÑ‡∏õ</button>
          <button id="btn-confirm" onclick="submitBooking()"
            class="flex-1 bg-green-500 text-white p-4 rounded-xl text-xl font-bold shadow-lg hidden">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
        </div>
      </div>

      <!-- Page: Activity (Placeholder) -->
      <div id="page-activity" class="hidden p-4 md:p-8 max-w-4xl mx-auto">
        <div class="flex items-center gap-4 mb-6">
          <button onclick="showPage('home')" class="bg-white p-3 rounded-full shadow-sm"><i
              class="fas fa-arrow-left"></i></button>
          <h2 class="text-3xl font-bold text-sky-800">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ä‡∏°‡∏£‡∏°</h2>
        </div>
        <div class="bg-white p-8 rounded-2xl text-center shadow-sm">
          <i class="fas fa-tools text-6xl text-gray-300 mb-4"></i>
          <h3 class="text-2xl text-gray-500">‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö</h3>
          <p class="text-gray-400">‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏≥‡πÑ‡∏ó‡πÄ‡∏Å‡πá‡∏Å‡πÅ‡∏•‡∏∞‡πÅ‡∏≠‡πÇ‡∏£‡∏ö‡∏¥‡∏Ñ</p>
        </div>
      </div>

      <!-- Mobile SOS -->
      <div class="md:hidden fixed bottom-6 right-6 left-6 z-50">
        <button onclick="triggerSOS()"
          class="w-full bg-red-600 text-white p-4 rounded-full text-xl font-bold shadow-xl border-4 border-white flex items-center justify-center gap-2 animate-bounce">
          <i class="fas fa-exclamation-circle"></i> ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô
        </button>
      </div>
    </main>
  </div>

  <!-- Script Section -->
  <script>
    // --- Facade API ---
    class APIFacade {
      constructor(baseUrl) { this.baseUrl = baseUrl; }
      async _request(endpoint, method = 'GET', body = null) {
        const options = { method, headers: { 'Content-Type': 'application/json' } };
        if (body) options.body = JSON.stringify(body);
        try {
          const res = await fetch(`${this.baseUrl}${endpoint}`, options);
          return res.ok ? await res.json() : { success: false, message: 'Server Error' };
        } catch (error) {
          console.error("API Error:", error);
          return { success: false, message: 'Connection Error' }; // Fallback
        }
      }
      async getVehicles() { return this._request('/vehicles'); }
      async bookVehicle(data) { return this._request('/book', 'POST', data); }
    }

    const apiService = new APIFacade('http://localhost:3001/api');

    // --- State ---
    let currentVehicle = null;
    let bookingData = {
      vehicleId: null,
      vehicleName: '',
      destination: '',
      destinationName: '',
      timeType: 'now', // 'now' or 'later'
      scheduledTime: '',
      passengers: 1,
      options: { wheelchair: false, helper: false }
    };
    let currentStep = 1;

    // --- Auth & Nav ---
    function handleLogin() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      document.getElementById('userNameDisplay').textContent = "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤ ‡∏™‡∏°‡∏ä‡∏≤‡∏¢";
      showPage('home');
    }

    function showPage(pageId) {
      ['home', 'shuttle', 'booking', 'activity'].forEach(p => document.getElementById(`page-${p}`).classList.add('hidden'));
      document.getElementById(`page-${pageId}`).classList.remove('hidden');
      if (pageId === 'shuttle') loadVehicles();
    }

    function toggleMobileMenu() { Swal.fire('Menu', '‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πâ‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠', 'info'); }

    // --- Vehicle List ---
    async function loadVehicles() {
      const list = document.getElementById('vehicleList');
      list.innerHTML = '<div class="text-center text-xl">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';

      // Try fetch, use fallback if server not running
      let vehicles = [];
      try {
        vehicles = await apiService.getVehicles();
        if (!Array.isArray(vehicles)) throw new Error("No data");
      } catch (e) {
        // Fallback Mock Data for Demo purposes if API fails
        vehicles = [
          { id: 1, type: 'Golf Cart', name: '‡∏£‡∏ñ‡∏Å‡∏≠‡∏•‡πå‡∏ü 01', status: 'available', icon: 'üõ∫' },
          { id: 2, type: 'Van', name: '‡∏£‡∏ñ‡∏ï‡∏π‡πâ A', status: 'available', icon: 'üöê' },
          { id: 3, type: 'Sidecar', name: '‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ã‡∏Ñ‡πå‡∏û‡πà‡∏ß‡∏á', status: 'out', icon: 'üõµ' }
        ];
      }

      list.innerHTML = '';
      vehicles.forEach(v => {
        const isAvail = v.status === 'available';
        list.innerHTML += `
                    <div class="${isAvail ? 'bg-white' : 'bg-gray-200 opacity-75'} p-6 rounded-2xl shadow-sm flex items-center justify-between border border-gray-100">
                        <div class="flex items-center gap-4">
                            <div class="text-4xl bg-gray-50 w-16 h-16 rounded-full flex items-center justify-center">${v.icon}</div>
                            <div>
                                <h3 class="text-2xl font-bold text-gray-800">${v.name}</h3>
                                <p class="text-lg ${isAvail ? 'text-green-600' : 'text-red-500'}">${isAvail ? '‡∏ß‡πà‡∏≤‡∏á' : '‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á'}</p>
                            </div>
                        </div>
                        <button ${!isAvail ? 'disabled' : ''} onclick="startBooking('${v.id}', '${v.name}')"
                            class="${isAvail ? 'bg-sky-600 hover:bg-sky-700 text-white' : 'bg-gray-400 text-white cursor-not-allowed'} px-6 py-3 rounded-xl font-bold text-lg shadow-md">
                            ${isAvail ? '‡∏à‡∏≠‡∏á‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ' : '‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á'}
                        </button>
                    </div>
                `;
      });
    }

    // --- Booking Wizard Logic ---
    function startBooking(id, name) {
      bookingData = {
        vehicleId: id, vehicleName: name,
        destination: '', destinationName: '',
        timeType: 'now', scheduledTime: '',
        passengers: 1, options: { wheelchair: false, helper: false }
      };
      document.getElementById('booking-vehicle-name').textContent = name;

      // Reset Wizard
      currentStep = 1;
      updateWizardUI();

      // Clear selections
      document.querySelectorAll('.dest-card').forEach(el => el.classList.remove('option-selected'));
      selectTimeType('now');
      document.getElementById('opt-wheelchair').checked = false;
      document.getElementById('opt-helper').checked = false;

      showPage('booking');
    }

    function updateWizardUI() {
      // Hide all steps
      [1, 2, 3].forEach(s => {
        document.getElementById(`step-${s}`).classList.add('hidden');
        const ind = document.getElementById(`step-${s}-ind`).querySelector('div');
        if (s === currentStep) {
          ind.className = 'w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold mb-1 step-active';
        } else if (s < currentStep) {
          ind.className = 'w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold mb-1 bg-sky-200 text-sky-800 border-sky-200';
          ind.innerHTML = '<i class="fas fa-check"></i>';
        } else {
          ind.className = 'w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold mb-1 step-inactive';
          ind.innerHTML = s;
        }
      });

      // Show current
      document.getElementById(`step-${currentStep}`).classList.remove('hidden');

      // Buttons
      document.getElementById('btn-back').classList.toggle('hidden', currentStep === 1);
      document.getElementById('btn-next').classList.toggle('hidden', currentStep === 3);
      document.getElementById('btn-confirm').classList.toggle('hidden', currentStep !== 3);
    }

    function nextStep() {
      if (currentStep === 1 && !bookingData.destination) {
        Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö', 'warning');
        return;
      }
      if (currentStep === 2) {
        // Save Step 2 Data
        bookingData.options.wheelchair = document.getElementById('opt-wheelchair').checked;
        bookingData.options.helper = document.getElementById('opt-helper').checked;
        if (bookingData.timeType === 'later') {
          const timeVal = document.getElementById('scheduled-time').value;
          if (!timeVal) {
            Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á', 'warning');
            return;
          }
          bookingData.scheduledTime = timeVal;
        }
        updateSummary();
      }
      if (currentStep < 3) {
        currentStep++;
        updateWizardUI();
      }
    }

    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        updateWizardUI();
      }
    }

    // --- Step 1 Helpers ---
    function selectDestination(val) {
      bookingData.destination = val;
      // Map value to Thai Name
      const names = { clubhouse: '‡∏™‡πÇ‡∏°‡∏™‡∏£', market: '‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡∏±‡∏î', clinic: '‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å', park: '‡∏™‡∏ß‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞' };
      bookingData.destinationName = names[val];

      document.querySelectorAll('.dest-card').forEach(el => el.classList.remove('option-selected'));
      document.querySelector(`.dest-card[data-value="${val}"]`).classList.add('option-selected');
    }

    // --- Step 2 Helpers ---
    function selectTimeType(type) {
      bookingData.timeType = type;
      const btnNow = document.getElementById('btn-time-now');
      const btnLater = document.getElementById('btn-time-later');
      const picker = document.getElementById('time-picker-container');

      if (type === 'now') {
        btnNow.classList.add('bg-sky-50', 'border-sky-500', 'text-sky-700');
        btnNow.classList.remove('border-gray-200', 'text-gray-500');
        btnLater.classList.remove('bg-sky-50', 'border-sky-500', 'text-sky-700');
        btnLater.classList.add('border-gray-200', 'text-gray-500');
        picker.classList.add('hidden');
      } else {
        btnLater.classList.add('bg-sky-50', 'border-sky-500', 'text-sky-700');
        btnLater.classList.remove('border-gray-200', 'text-gray-500');
        btnNow.classList.remove('bg-sky-50', 'border-sky-500', 'text-sky-700');
        btnNow.classList.add('border-gray-200', 'text-gray-500');
        picker.classList.remove('hidden');
      }
    }

    function adjustPassenger(delta) {
      let newVal = bookingData.passengers + delta;
      if (newVal < 1) newVal = 1;
      if (newVal > 4) newVal = 4;
      bookingData.passengers = newVal;
      document.getElementById('passenger-count').textContent = newVal;
    }

    // --- Step 3 Helpers ---
    function updateSummary() {
      document.getElementById('sum-vehicle').textContent = bookingData.vehicleName;
      document.getElementById('sum-dest').textContent = bookingData.destinationName;

      let timeStr = bookingData.timeType === 'now' ? '‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏î‡πà‡∏ß‡∏ô)' : `‡∏à‡∏≠‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ ${bookingData.scheduledTime} ‡∏ô.`;
      document.getElementById('sum-time').textContent = timeStr;
      document.getElementById('sum-passengers').textContent = `${bookingData.passengers} ‡∏ó‡πà‡∏≤‡∏ô`;

      let opts = [];
      if (bookingData.options.wheelchair) opts.push('‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô');
      if (bookingData.options.helper) opts.push('‡∏Ñ‡∏ô‡∏û‡∏¢‡∏∏‡∏á');
      document.getElementById('sum-options').textContent = opts.length > 0 ? opts.join(', ') : '-';
    }

    // --- Final Submit ---
    async function submitBooking() {
      // Loading UI
      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏£‡∏ñ...',
        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading()
      });

      const res = await apiService.bookVehicle({
        vehicleId: bookingData.vehicleId,
        location: '‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å (GPS)',
        destination: bookingData.destination,
        time: bookingData.timeType === 'now' ? 'now' : bookingData.scheduledTime,
        options: bookingData.options
      });

      if (res.success || res.booking) { // Adapt based on API response structure
        // Update Home Status
        const statusCard = document.getElementById('statusCard');
        statusCard.classList.remove('border-gray-300');
        statusCard.classList.add('border-sky-500', 'bg-sky-50');
        statusCard.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-xl font-bold text-sky-700">‡∏£‡∏ñ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏≤‡∏£‡∏±‡∏ö!</h3>
                            <p class="text-2xl mt-1 font-bold text-gray-800">${bookingData.vehicleName}</p>
                            <p class="text-lg text-gray-600">‡∏≠‡∏µ‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô</p>
                        </div>
                        <div class="text-4xl text-sky-500"><i class="fas fa-shipping-fast"></i></div>
                    </div>
                `;

        Swal.fire({
          icon: 'success',
          title: '‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏£‡∏ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
          text: '‡∏£‡∏ñ‡∏Å‡∏≠‡∏•‡πå‡∏ü‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏°‡∏≤‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö',
          confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
          confirmButtonColor: '#0ea5e9'
        }).then(() => {
          showPage('home');
        });
      } else {
        Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', res.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡∏£‡∏ñ‡πÑ‡∏î‡πâ', 'error');
      }
    }

    function triggerSOS() {
      Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô?',
        text: "‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏µ‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏±‡∏ô‡∏ó‡∏µ",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: '‡πÉ‡∏ä‡πà! ‡πÅ‡∏à‡πâ‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡πâ‡∏ß!', '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏°‡∏≤', 'success');
        }
      });
    }
  </script>
</body>

</html>